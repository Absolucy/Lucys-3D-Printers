[gcode_macro SET_PRINT_OPTIONS]
description: Sets where to do bed meshing when starting a print or not.
gcode:
	{% if 'bed_mesh' in params|lower %}
		{% set enable_bed_meshing = params.BED_MESH|int %}
		{action_respond_info("%s bed meshing by default." % ("Enabling" if enable_bed_meshing else "Disabling"))}
		SAVE_VARIABLE VARIABLE=bed_mesh VALUE={enable_bed_meshing}
	{% endif %}

	{% if 'z_tilt' in params|lower %}
		{% set enable_z_tilt = params.Z_TILT|int %}
		{action_respond_info("%s Z tilt adjustment by default." % ("Enabling" if enable_z_tilt else "Disabling"))}
		SAVE_VARIABLE VARIABLE=z_tilt VALUE={enable_z_tilt}
	{% endif %}

	{% if 'nozzle' in params|lower %}
		{% set default_nozzle_size = params.NOZZLE|float|round(2) %}
		{action_respond_info("Setting default nozzle size to %smm." % (default_nozzle_size))}
		SAVE_VARIABLE VARIABLE=nozzle_size VALUE={default_nozzle_size}
	{% endif %}

	{% if 'purge' in params|lower %}
		{% set purge_mode = params.PURGE|string|lower %}
		{% if not purge_mode in ('adaptive', 'basic') %}
			{action_raise_error("Invalid purge mode '%s', expected either 'adaptive' or 'basic'" % (purge_mode))}
		{% endif %}
		{action_respond_info("Setting default purge mode to %s." % (purge_mode))}
		SAVE_VARIABLE VARIABLE=purge_mode VALUE='"{purge_mode}"'
	{% endif %}

[gcode_macro RESET_PRINT_OPTIONS]
description: Resets all default print options.
gcode:
	SET_PRINT_OPTIONS BED_MESH=1 Z_TILT=1 NOZZLE=0.4 PURGE=adaptive
